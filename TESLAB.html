<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BoardingGate Lanzador</title>
    <link rel="icon" href="https://boardinggate.github.io/Tesla/th.jpeg" type="image/jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
<style>
    /* --- START OF CSS (No changes) --- */
    .bookmark-item { transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5), -4px -4px 8px rgba(255, 255, 255, 0.1); position: relative; cursor: pointer; }
    .bookmark-item:hover:not(.editing-active) { transform: scale(1.05) translateY(-1px); box-shadow: 6px 6px 12px rgba(0, 0, 0, 0.6), -6px -6px 12px rgba(255, 255, 255, 0.15); }
    .bookmark-item img { image-rendering: crisp-edges; }
    .bookmark-name { font-weight: bold; color: #333; text-align: center; margin-top: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }
    #bookmark-grid { display: grid; grid-template-columns: repeat(6, minmax(120px, 1fr)); gap: 15px; background-color: transparent; border-radius: 0.75rem; position: relative; width: 100%; max-width: 984px; margin: 0 auto 0 85px; transition: all 0.3s ease; }
    #bookmark-grid > div { height: auto; aspect-ratio: 16 / 9; transition: all 0.3s ease; }
    .bookmark-item { width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 0.5rem; transition: all 0.3s ease; background-color: hsla(var(--hue), var(--saturation), var(--lightness), 0.64); }
    .bookmark-item img { width: 36px; height: auto; max-width: 40px; border-radius: 0.25rem; }
    .bookmark-name { font-size: clamp(0.85rem, 1.5vw, 1.15rem); }
    .small-bookmark img { width: 24px; max-width: 28px; } .small-bookmark .bookmark-name { font-size: clamp(0.85rem, 1.5vw, 1.15rem); }
    @media (max-width: 768px) { #bookmark-grid { grid-template-columns: repeat(3, minmax(100px, 1fr)); gap: 10px; } }
    @media (max-width: 480px) { #bookmark-grid { grid-template-columns: repeat(2, minmax(80px, 1fr)); gap: 8px; } }
    .header-container { display: flex; align-items: center; justify-content: center; gap: 0.5rem; background-color: #ABAB99; padding: 0.5rem; }
    body.dark-mode .header-container { background-color: #92927E; } .header-logo { width: 100px; height: 70px; transition: filter 0.2s ease; } body.dark-mode .header-logo { filter: brightness(85%); } .title-container { background-color: #ABAB99; padding: 0.5rem 1rem; border-radius: 0.5rem; display: inline-block; } body.dark-mode .title-container { background-color: #92927E; } .header-container h1 { color: #5C5C47; } .version-text { font-size: 0.75rem; color: #5C5C47; font-weight: normal; }
    body { display: flex; flex-direction: column; min-height: 100vh; background-color: #ABAB99; margin: 0; overflow-x: hidden; } body.dark-mode { background-color: #92927E; } header { margin-bottom: 0.5rem; }
    main { position: relative; margin: 10px auto 0.5rem 60px; background-color: transparent; border-radius: 0.75rem; padding: 16px; min-height: 400px; max-width: 984px; width: 100%; transition: margin-top 0.5s ease-in-out; position: relative; }
    footer { margin: 0.5rem auto; text-align: center; max-width: 984px; width: 100%; display: block; background-color: #ABAB99; margin-left: 145px; } body.dark-mode footer { background-color: #92927E; } .footer-content { color: #5C5C47; padding: 0.5rem; margin: 0 auto; max-width: 100%; position: relative; } .footer-subtext { font-size: 0.75rem; color: #5C5C47; margin-top: 0.25rem; text-align: center; } .footer-link-green { color: #5C5C47; text-decoration: none; transition: color 0.2s ease; } .footer-link-green:hover { color: #5C5C47; } .footer-line { display: flex; justify-content: center; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
    .toggle-image, .toggle-sign { width: 135px; height: 74px; margin-bottom: 2px; box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4); border: 1px solid #7c7c68; left: 10px; z-index: 1000; transition: background-color 0.2s ease, filter 0.2s ease, top 0.3s ease, border 0.2s ease; border-radius: 35px; align-items: center; justify-content: center; cursor: pointer; display: flex; position: fixed; top: 90px; /* Initial top, adjustButtonPositions overrides */ }
    .scroll-toggle-button { position: fixed; width: 110px !important; height: clamp(75px, 20vw, 130px) !important; background-color: #ABAB99; border-radius: 60px; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: clamp(10px, 2vw, 20px); cursor: pointer; box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4) !important; border: 1px solid #808080 !important; z-index: 1001; transition: background-color 0.2s ease; left: 10px; top: 10px; } .scroll-toggle-button:hover { background-color: #668B8B; } .scroll-toggle-button svg { width: clamp(24px, 4vw, 32px); height: clamp(24px, 4vw, 32px); stroke: #E6E6DC; }
    #config-button, #personal-button, #home-button, #reload-button { width: auto !important; height: auto !important; background-color: transparent !important; border: none !important; box-shadow: none !important; padding: 5px !important; position: absolute !important; top: 27px !important; z-index: 900 !important; cursor: pointer; border-radius: 50%; transition: transform 0.1s ease, background-color 0.2s ease; }
    #config-button { left: 185px !important; } #personal-button { left: 250px !important; } #home-button { left: 315px !important; } #reload-button { left: 380px !important; }
    #config-button img { max-width: 41px !important; max-height: 41px !important; width: 41px; height: 41px; object-fit: contain; display: block; filter: none !important; } #personal-button img, #home-button img, #reload-button img { max-width: 37px !important; max-height: 37px !important; width: 37px; height: 37px; object-fit: contain; display: block; filter: none !important; }
    #config-button:hover, #personal-button:hover, #home-button:hover, #reload-button:hover { transform: scale(1.1); background-color: rgba(255, 255, 255, 0.2); }
    #personal-button.editing { border: 3px solid yellow !important; box-shadow: 0 0 10px yellow !important; }
    body.dark-mode #config-button img { filter: brightness(65%); } body.dark-mode #personal-button img { filter: brightness(65%); }
    #user-id-display { position: absolute; top: -25px; right: 0px; margin-right: 60px; font-weight: bold; font-size: 1.1rem; color: #5C5C47; padding: 4px 8px; background-color: rgba(171, 171, 153, 0.7); border-radius: 4px; z-index: 800; white-space: nowrap; text-align: right; } body.dark-mode #user-id-display { color: #E6E6DC; background-color: rgba(146, 146, 126, 0.7); opacity: 0.7; }
    .top-text-container { display: flex; align-items: center; justify-content: center; font-size: clamp(0.6rem, 1.5vw, 0.75rem); color: #5C5C47; background-color: #ABAB98; margin-top: 0.25rem; margin-left: 70px; gap: 0.5rem; padding: 0.25rem 0.5rem; border-radius: 0.25rem; animation: fadeOut 4s forwards; position: relative; height: 2rem; transition: opacity 0.5s ease-in-out; box-sizing: border-box; z-index: 1900; } body.dark-mode .top-text-container { background-color: #6B7280; } .top-text-container span { color: #5C5C47; font-size: clamp(0.9rem, 2vw, 1.2rem); } @keyframes fadeOut { 0% { opacity: 1; height: 2rem; } 75% { opacity: 1; height: 2rem; } 100% { opacity: 0; height: 2rem; pointer-events: none; } }
    .arrow-button { width: clamp(36px, 6vw, 48px); height: clamp(36px, 6vw, 48px); background-color: #668B8B; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); transition: background-color 0.2s ease; } .arrow-button:hover { background-color: #5C5C47; } .arrow-button svg { stroke: #E6E6DC; }
    .counter-container { display: flex; justify-content: center; align-items: center; flex-direction: column; margin-top: 1rem; text-align: center; opacity: 0.2; margin-left: 145px; }
    .favicon-red { filter: hue-rotate(0deg) saturate(200%) brightness(80%); } .favicon-blue { filter: hue-rotate(200deg) saturate(150%) brightness(90%); }
    .notices-icon-container { display: flex; align-items: center; justify-content: center; width: 100%; max-width: 984px; margin: 0 auto; margin-left: 165px; position: relative; } .notices-container { flex-grow: 1; padding: 0.5rem; border: none; border-radius: 0.5rem; overflow: hidden; display: flex; align-items: center; justify-content: center; gap: 0; margin-left: 2px; height: 3rem; } .notice-wrapper { padding: 0.5rem; height: 1.5rem; flex-grow: 1; overflow: hidden; position: relative; display: flex; align-items: center; justify-content: center; } .notice { color: #E6E6DC; font-size: 1.3rem; font-weight: bold; white-space: nowrap; text-align: center; opacity: 0; animation: fadeInOut 14s infinite; } @keyframes fadeInOut { 0% { opacity: 1; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { opacity: 0; } } .notice-off-icon { width: auto; height: clamp(2rem, 5vw, 3rem); margin-right: 10px; align-self: center; cursor: pointer; transition: filter 0.3s ease; } body.dark-mode .notice-off-icon { filter: brightness(85%); }
    .toggle-sign { background-color: #ABAB99; font-weight: bold; font-size: 1.25rem; color: #000000; text-align: center; } .toggle-sign .sign { font-size: 1.5rem; margin-right: 2px; } .toggle-sign:hover:not(#config-button):not(#personal-button):not(#home-button):not(#reload-button) { background-color: #D9A066; } .toggle-sign img, .toggle-image img { max-width: 70%; max-height: 70%; object-fit: contain; } body.dark-mode .toggle-sign#config-button { filter: brightness(85%); background-color: transparent !important; }
    .toggle-image {} .toggle-image:hover { filter: brightness(80%); } body.dark-mode .toggle-image#on-off-toggle { filter: brightness(85%); }
    #reminder-button { display: flex; flex-direction: column; justify-content: center; align-items: center; position: fixed; background-color: #ABAB99; } #reminder-button img { object-fit: contain; } #reminder-button .reminder-count { position: absolute; top: 6px; left: 8px; background-color: #EF4444; color: #FFFFFF; border-radius: 55%; padding: 4px 10px; font-size: 1.1rem; font-weight: bold; line-height: 1; display: flex; align-items: center; justify-content: center; z-index: 1500; min-width: 1.9rem; max-width: 2.5rem; text-align: center; }
    .hidden { display: none !important; } .footer-hidden { display: none; } body.dark-mode .bookmark-item { filter: brightness(60%); } body.dark-mode .bg-gray-50.border.border-dashed.border-gray-200.rounded-lg { filter: brightness(60%); } body.dark-mode .scroll-toggle-button { background-color: #ABAB99; } body.dark-mode .scroll-toggle-button:hover { background-color: #ABAB99; } body.dark-mode .toggle-sign:not(#config-button):not(#personal-button):not(#home-button):not(#reload-button) { background-color: #ABAB99; } body.dark-mode .toggle-sign:not(#config-button):not(#personal-button):not(#home-button):not(#reload-button):hover { background-color: #ABAB99; } body.dark-mode .toggle-sign.range-toggle[data-state="visible"] { background-color: #ABAB99; } body.dark-mode .toggle-sign.range-toggle[data-state="hidden"] { background-color: #ABAB99; } .toggle-sign.range-toggle[data-state="hidden"] { color: #7F7F7F; } body.dark-mode #reload-button {} body.dark-mode #home-button {} body.dark-mode #personal-button {} body.dark-mode #weather-button { background-color: #ABAB99; } body.dark-mode #zoom-button:not(.zoomed) { background-color: #ABAB99; } body.dark-mode #zoom-button.zoomed { background-color: #ABAB99; } body.dark-mode #reminder-button { background-color: #ABAB99; }
    .reminder-modal { position: fixed; top: 2%; left: 3%; transform: translateY(-1%); background-color: #D2B48C; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 2000; max-width: 1050px; width: 98%; max-height: 700px; overflow-y: auto; font-weight: bold; font-size: 1.3rem; }
    .help-modal, .edit-info-modal { position: fixed; top: 10%; left: 35px; transform: translateY(-10%); background-color: #DAC8A0; padding: 2rem; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 2000; max-width: 1020px; width: 98%; max-height: 80vh; overflow-y: auto; font-size: 1.10rem; }
    .reminder-modal h2, .help-modal h2, .edit-info-modal h2 { font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; color: #111827; }
    .reminder-modal label, .help-modal label, .edit-info-modal label { display: block; margin-bottom: 0.25rem; font-weight: 500; color: #374151; font-size: 1.1rem; }
    .reminder-modal textarea#reminder-text { width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; border: 1px solid #D1D5DB; border-radius: 0.25rem; font-size: 1.4rem; font-weight: bold; text-transform: uppercase; }
    .reminder-modal input[type="text"], .reminder-modal input[type="number"] { width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; border: 1px solid #D1D5DB; border-radius: 0.25rem; font-size: 2rem; text-align: center; }
    .reminder-modal .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
    .reminder-modal .full-width { grid-column: span 3; } .reminder-modal .days-group { display: flex; gap: 2rem; flex-wrap: wrap; }
    .reminder-modal .button-group { display: flex; justify-content: space-between; gap: 0.5rem; flex-wrap: nowrap; margin-top: 1rem; }
    .reminder-modal .days-group label { font-size: 1.3rem; }
    .reminder-modal button, .help-modal button, .edit-info-modal button { padding: 0.5rem 1rem; border-radius: 0.25rem; cursor: pointer; font-size: 1.3rem; flex: 1; text-align: center; min-width: 100px; }
    .reminder-modal button[type="submit"] { background-color: #2563EB; height:70px; font-weight: bold; font-size: 1.5rem; color: #FFFFFF; display: flex; align-items: center; justify-content: center; gap: 0.6rem; }
    .reminder-modal button[type="submit"] span#countdown-save { font-size: 1.6rem; font-weight: bold; justify-content: right; color: #e6e6dc; }
    .reminder-modal button[type="button"] { background-color: #D1D5DB; color: #111827; }
    .help-modal button#close-help, .edit-info-modal button#close-edit-info { background-color: #2563EB; color: #FFFFFF; font-size: 1.5rem; padding: 1rem 2rem; height:70px; }
    .reminder-notification { position: fixed; top: 45%; left: 55%; transform: translate(-85%, -85%); background-color: #FFFF99; padding: 1.5rem; border-radius: 2.5rem; border: 2px solid #ABAB99; box-shadow: 0 6px 6px rgba(1, 0, 0, 0.3); z-index: 3000; max-width: 470px; width: 95%; text-align: center; }
    .reminder-notification .reminder-text { margin: 0.5rem 0; font-size: 1.8rem; font-weight: bold; color: #0000FF; } .reminder-notification .reminder-details { margin: 0.5rem 0; font-size: 1.0rem; font-weight: bold; color: #0000FF; } .reminder-notification .button-group { display: flex; justify-content: center; gap: 0.5rem; margin-top: 1rem; } .reminder-notification button { padding: 0.5rem 1rem; border-radius: 0.25rem; cursor: pointer; font-size: 0.9rem; } .reminder-notification button.cancel { background-color: #EF4444; color: #FFFFFF; font-weight: bold; width: 150px; height:70px; font-size: 1.2rem; } .reminder-notification button.modify { background-color: #10B981; font-weight: bold; width: 150px; height:60px; font-size: 1.2rem; color: #FFFFFF; } .reminder-notification button.postpone { background-color: #F59E0B; width: 150px; font-weight: bold; height:60px; font-size: 1.2rem; color: #FFFFFF; }
    .reminder-table-modal { position: fixed; top: 30px; left: 35px; transform: translateY(10%); background-color: #E6D6A8; padding: 1.5rem; border-radius: 1.5rem; box-shadow: 0 4px 6px rgba(1, 1, 0, 0.1); z-index: 2000; max-width: 99%; width: 1090px; max-height: 80vh; overflow-y: auto; }
    .reminder-table-modal table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; } .reminder-table-modal tbody tr { cursor: pointer; } .reminder-table-modal tbody tr:hover { background-color: rgba(0, 0, 0, 0.05); } .reminder-table-modal th, .reminder-table-modal td { padding: 0.5rem; border: 1px solid #1E3A8A; font-size: 1.1rem; text-align: center; vertical-align: middle; } .reminder-table-modal td.text-column { text-align: left; } .reminder-table-modal th { background-color: #E5E7EB; font-weight: bold; } .reminder-table-modal td.date-column { white-space: nowrap; } .reminder-table-modal td:first-child { display: flex; justify-content: space-around; align-items: center; gap: 0.5rem; padding: 0.3rem 0.5rem; border: none; } .reminder-table-modal td:first-child button { padding: 0.5rem 0.8rem; font-size: 0.85rem; flex: 0 1 auto; margin: 0; } .reminder-table-modal button.modify { background-color: #10B981; font-size: 1rem; height:70px; color: #000000; } .reminder-table-modal button.delete { background-color: #EF4444; font-size: 1.2rem; height:65px; color: #FFFFFF; } .reminder-table-modal button.postpone { background-color: #F59E0B; font-size: 1.2rem; height:65px; color: #FFFFFF; } .reminder-table-modal .button-group { display: flex; margin-top: 1rem; } .reminder-table-modal #close-reminders, .reminder-table-modal #close-reminders-top { padding-left: 3rem; padding-right: 3rem; background-color: #2563EB; color: white; padding: 0.75rem 3rem; border-radius: 0.5rem; font-size: 1.25rem; font-weight: bold; border: 2px solid #1E3A8A; cursor: pointer; transition: background-color 0.2s ease; display: inline-flex; align-items: center; } .reminder-table-modal #close-reminders:hover, .reminder-table-modal #close-reminders-top:hover { background-color: #1D4ED8; } .reminder-table-modal .top-button-container { display: flex; justify-content: flex-end; margin-bottom: 1rem; }
    .button-countdown { margin-left: 8px; font-weight: bold; font-size: 1.1em; opacity: 0.85; }
    .reminder-count-globe { position: fixed; top: 10px; left: 10px; background-color: #EF4444; color: white; border-radius: 65%; padding: 10px 15px; font-size: 1.3rem; font-weight: bold; z-index: 1500; }
    .reminder-count-globe, #reminder-notifications, .notices-icon-container, footer { transition: margin-top 0.5s ease-in-out; }
    .speech-button { background-color: #668B8B; color: white; border: none; border-radius: 0.25rem; padding: 0.5rem; cursor: pointer; margin-left: 0.5rem; font-size: 1rem; vertical-align: top; } .speech-button:hover { background-color: #668B8B; } .speech-status { font-size: 0.85rem; color: #ABAB99; margin-top: 0.25rem; min-height: 1.2em; } #auto-save-timer { color: #1E40AF; }
    .statcounter-container { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 0.25rem; }
    .toast-notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 25px; color: white; font-size: 1rem; font-weight: 500; z-index: 9999; opacity: 0; transition: opacity 0.4s ease-in-out, bottom 0.4s ease-in-out; box-shadow: 0 4px 10px rgba(0,0,0,0.2); text-align: center; min-width: 250px; max-width: 80%; } .toast-notification.show { opacity: 1; bottom: 40px; } .toast-success { background-color: #28a745; } .toast-error { background-color: #dc3545; } .toast-warning { background-color: #ffc107; color: #333; } .toast-info { background-color: #17a2b8; }
    /* Edit Mode Styles */ .editable:hover { outline: 2px dashed yellow; outline-offset: 2px; } .editing-active .bookmark-item:hover, .editing-active .range-toggle:hover { transform: none; box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5), -4px -4px 8px rgba(255, 255, 255, 0.1); outline: 3px solid yellow; cursor: crosshair; } .edit-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #EADDCA; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 6000; width: 90%; max-width: 500px; border: 1px solid #A0522D; } .edit-modal h2 { font-size: 1.4rem; margin-bottom: 1rem; color: #333; font-weight: bold; text-align: center; } .edit-modal label { display: block; margin-bottom: 0.3rem; font-weight: 500; color: #444; font-size: 1rem; } .edit-modal input[type="text"], .edit-modal input[type="url"] { width: 100%; padding: 0.6rem; margin-bottom: 0.8rem; border: 1px solid #BDB7AB; border-radius: 0.25rem; font-size: 1rem; } .edit-modal .button-group { display: flex; justify-content: space-between; gap: 1rem; margin-top: 1.5rem; } .edit-modal button { padding: 0.7rem 1rem; font-size: 1rem; border-radius: 0.25rem; cursor: pointer; border: none; flex: 1; } .edit-modal button.save { background-color: #28a745; color: white; } .edit-modal button.save:hover { background-color: #218838; } .edit-modal button.cancel { background-color: #6c757d; color: white; } .edit-modal button.cancel:hover { background-color: #5a6268; } .edit-modal button.reset { background-color: #ffc107; color: #333; } .edit-modal button.reset:hover { background-color: #e0a800; }
    /* --- END OF CSS --- */
</style>
</head>
<body class="min-h-screen bg-[#ABAB99] flex flex-col items-center p-6">

    <div class="top-text-container">
        <div class="arrow-button" id="back-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </div>
        <span>[ Web anterior o posterior arrastre ]</span>
        <div class="arrow-button" id="forward-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </div>
    </div>
    <div class="reminder-count-globe" id="reminder-count-globe"></div>
    <div id="reminder-notifications"></div>
<main>
    <div id="user-id-display"></div>
    <div id="bookmark-grid">
        <!-- Grid items will be generated by JavaScript -->
    </div>
</main>

<div class="notices-icon-container">
    <img src="https://boardinggate.github.io/Tesla/IMG_4194.jpg" alt="Toggle Avisos" class="notice-off-icon" id="notice-toggle-icon">
    <div class="notices-container">
        <div class="notice-wrapper">
            <span class="notice" id="current-notice"></span>
        </div>
    </div>
</div>

<footer>
    <div class="footer-content">
        <div class="header-container">
            <img src="https://boardinggate.github.io/Tesla/LOGOTESLA.jpg" class="header-logo">
            <div class="title-container">
                <h1 class="text-2xl font-bold inline">
                    <span class="text-2xl">BoardingGate</span>
                    <span class="text-base">Lanzador</span>
                    <span id="version" class="version-text"></span>
                </h1>
            </div>
        </div>
        <div class="footer-line">
            <a href="https://x.com/boardinggate?s=21" class="footer-link-green" target="_blank" rel="noopener noreferrer">@BoardingGate</a>
            <span class="text-green-200" style="font-size: 1.5rem;">🤝</span>
            <a href="https://x.com/boardinggate/status/1857325553742721116?s=46" class="footer-link-green" target="_blank" rel="noopener noreferrer">Ahorremos un dinero con mis REFERIDOS</a>
        </div>

        <div class="statcounter-container">
          <div style="display: inline-flex; align-items: center; gap: 10px;">
            <script type="text/javascript">
              var sc_project=13126275;
              var sc_invisible=0;
              var sc_security="0fc568cc";
              var scJsHost = "https://";
              document.write("<sc"+"ript type='text/javascript' src='" +
              scJsHost+
              "statcounter.com/counter/counter.js'></"+"script>");
            </script>
            <noscript><div class="statcounter"><a title="Web Analytics"
            href="https://statcounter.com/" target="_blank"><img
            class="statcounter"
            src="https://c.statcounter.com/13126275/0/0fc568cc/0/"
            alt="Web Analytics"
            referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
            <a href="https://statcounter.com/p13126275/?guest=1" class="footer-subtext">Legionarios de Elon</a>
          </div>
        </div>

        <p class="footer-subtext">La inteligencia tiene ciertas limitaciones. La locura, casi ninguna 🫶 🤟</p>
    </div>
</footer>


<div id="scroll-toggle" class="scroll-toggle-button" title="Ir al inicio o fin">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
</div>

<script>
    // --- Original Data (Keep as const for reference) ---
    const originalBookmarks = [ { name: "YouTube", url: "https://www.youtube.com" }, { name: "Google", url: "https://www.google.com" }, { name: "GDrive", url: "https://drive.google.com", favicon: "./IMG_4172.png" }, { name: "GMail", url: "https://mail.google.com/mail/mu/mp/603/#tl/Recibidos", favicon: "./IMG_4171.png"}, { name: "Google Fotos", url: "https://photos.google.com" }, { name: "iCloud", url: "https://www.icloud.com/", favicon: "https://www.google.com/s2/favicons?domain=icloud.com&sz=64" }, { name: "ABRP", url: "https://abetterrouteplanner.com" }, { name: "ElectroMaps", url: "https://map.electromaps.com/es/", favicon: "https://www.google.com/s2/favicons?domain=electromaps.com&sz=64" }, { name: "REVE PdR España", url: "https://www.mapareve.es/mapa-puntos-recarga", favicon: "https://www.google.com/s2/favicons?domain=mapareve.es&sz=64" }, { name: "PdR,s", url: "https://www.google.com/maps/search/puntos+recarga+veh%C3%ADculos+el%C3%A9ctricos", favicon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M12 18h8v2h-8v-2z'/><path d='M12 14h8v2h-8v-2z'/><path d='M12 10h8v2h-8v-2z'/><path d='M12 6h8v2h-8V6z'/><path d='M4 18h4v-2H4v2zM4 14h4v-2H4v2zM4 10h4v-2H4v2zM4 6h4V4H4v2z'/></svg>" }, { name: "Google Maps", url: "https://maps.google.com" }, { name: "WhatsApp", url: "https://web.whatsapp.com/" }, { name: "TESSIE", url: "https://dash.tessie.com/signin", favicon: "https://www.google.com/s2/favicons?domain=tessie.com&sz=64" }, { name: "Mis Updates", url: "https://dash.tessie.com/software", favicon: "https://cdn-icons-png.flaticon.com/512/148/148767.png" }, { name: "Olas Updates", url: "https://es.stats.tessie.com/", favicon: "https://cdn-icons-png.flaticon.com/512/5815/5815902.png" }, { name: "NotaTeslaApp", url: "https://www.notateslaapp.com/software-updates/" }, { name: "ENHAUTO", url: "https://www.enhauto.com" }, { name: "MAREAS", url: "https://www.meteogalicia.gal/web/predicion/mareas-e-luas" }, { name: "ELECTROVERSE", url: "https://electroverse.com/es/map", favicon: "https://www.google.com/s2/favicons?domain=electroverse.com&sz=64" }, { name: "ACCIONA", url: "https://www.google.com/maps/search/recarga+Acciona", favicon: "https://www.google.com/s2/favicons?domain=acciona.com&sz=64" }, { name: "IBERDROLA", url: "https://www.google.com/maps/search/recarga+IBERDROLA", favicon: "https://www.google.com/s2/favicons?domain=iberdrola.com&sz=64" }, { name: "WAYLET Repsol", url: "https://www.google.com/maps/search/recarga+REPSOL+Waylet", favicon: "https://www.google.com/s2/favicons?domain=repsol.com&sz=64" }, { name: "ENDESA xWay", url: "https://www.google.com/maps/search/recarga+ENDESA+XWAY", favicon: "https://www.google.com/s2/favicons?domain=endesa.com&sz=64" }, { name: "ZUNDER", url: "https://www.google.com/maps/search/recarga+ZUNDER", favicon: "https://www.google.com/s2/favicons?domain=zunder.com&sz=64" }, { name: "IONITY", url: "https://www.google.com/maps/search/recarga+IONITY", favicon: "https://www.google.com/s2/favicons?domain=ionity.eu&sz=64" }, { name: "WENEA", url: "https://www.google.com/maps/search/recarga+WENEA", favicon: "https://www.google.com/s2/favicons?domain=wenea.com&sz=64" }, { name: "T.ENERGIES", url: "https://www.google.com/maps/search/recarga+TOTAL+ENERGIES", favicon: "https://www.google.com/s2/favicons?domain=totalenergies.com&sz=64" }, { name: "GALP", url: "https://www.google.com/maps/search/recarga+GALP", favicon: "https://www.google.com/s2/favicons?domain=galp.com&sz=64" }, { name: "MIIO", url: "https://miio.com", favicon: "https://www.google.com/s2/favicons?domain=miio.com&sz=64" }, { name: "EVDC", url: "https://evdc.network", favicon: "https://www.google.com/s2/favicons?domain=evdc.network&sz=64" }, { name: "GROK", url: "https://grok.com/?referrer=website" }, { name: "CHATGPT", url: "https://chat.openai.com" }, { name: "CLAUDE", url: "https://claude.ai/new" }, { name: "GEMINI", url: "https://gemini.google.com" }, { name: "NOTEBOOKLM", url: "https://notebooklm.google.com" }, { name: "Batería", url: "https://docs.google.com/spreadsheets/d/1bLZmgVGTBqg2bS2E45JpORjs9eK2nb05AWXYLLDY-RI/edit?gid=1398548891#gid=1398548891", favicon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='12' cy='12' r='10'/><polyline points='12 6 12 12 16 14'/></svg>" }, { name: "TeslaParaTodos", url: "https://teslaparatodos.com/cine/" }, { name: "BetterTheater", url: "https://abettertheater.com", favicon: "https://www.google.com/s2/favicons?domain=abettertheater.com&sz=64" }, { name: "Filmin", url: "https://www.filmin.es/catalogo/peliculas" }, { name: "Octopus", url: "https://octopusenergy.es/login" }, { name: "App MCE", url: "https://www.oscarabilleira.com/app-mi-coche-electrico/#ayuda" }, { name: "Patrón Luz", url: "https://docs.google.com/spreadsheets/d/1R7UUZ9i4BAYWAGAX6PQT1WGd12GEZ4Ja/edit?usp=sharing&ouid=108345701896498198132&rtpof=true&sd=true" }, { name: "TradingView", url: "https://es.tradingview.com/chart/t5g9UFG0/" }, { name: "Telegram", url: "https://web.telegram.org/a/" }, { name: "Twitter", url: "https://x.com" }, { name: "Maesal Detailer", url: "https://www.maesaldetailer.es/" }, { name: "Superchargers", url: "https://www.tesla.com/es_es/findus?bounds=45.41107111786193%2C19.27853056943938%2C29.703668286784747%2C-16.64676239931062" }, { name: "TESLA web", url: "https://www.tesla.com/es_es" }, { name: "Manual M3", url: "https://www.tesla.com/ownersmanual/model3/es_es/" }, { name: "de Servicio", url: "https://service.tesla.com/docs/Model3/ServiceManual/2024/es-es/" }, { name: "de Despiece", url: "https://epc.tesla.com/es-MX/catalogs/e0e07c3d-272f-4d06-b8b6-9e92f857e5f3" }, { name: "de Usted Mismo", url: "https://www.tesla.com/es_es/support/do-it-yourself-guides" }, { name: "de Filtro Cabina", url: "https://service.tesla.com/docs/Public/diy/model3/es_es/GUID-DB0A1E3C-926E-498C-A2FD-A27B8421A471.html" }, { name: "de Móvil remoto", url: "https://service.tesla.com/docs/Public/diy/model3/es_es/GUID-53651B16-A2E3-4118-933E-B5F41C74D433.html" }, { name: "Waze (consultas)", url: "https://www.waze.com/es/live-map/", favicon: "https://www.google.com/s2/favicons?domain=waze.com&sz=64" }, { name: "AMAZON", url: "https://www.amazon.es" }, { name: "BIP&DRIVE", url: "https://areaprivada.bipdrive.com/login" }, { name: "ITV Cita", url: "https://www.sycitv.com/es/cita-previa-particulares/", favicon: "https://boardinggate.github.io/Tesla/itv.png" }, { name: "Deportes", url: "https://www.sofascore.com/es/tenis" }, null, { name: "Jaime Odena", url: "https://www.youtube.com/@JOdena", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Eduardo Arcos", url: "https://www.youtube.com/@earcos", favicon: "https://www.youtube.com/favicon.ico" }, { name: "AutoIngenium", url: "https://www.youtube.com/@AutoIngenium", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Gallego en Munich", url: "https://www.youtube.com/@ungallegoenmunich", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Electromiaumiau", url: "https://www.youtube.com/@electromiaumiau", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Manuel Martos", url: "https://www.youtube.com/@Manuel_Martos", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Todos Electricos", url: "https://www.youtube.com/@TodosElectricos", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Juan Vidal Haces", url: "https://www.youtube.com/@JuanVidalHaces", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Ruedana", url: "https://www.youtube.com/@ruedana", favicon: "https://www.youtube.com/favicon.ico" }, { name: "STR-600", url: "https://www.youtube.com/@STR-600", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Juanjo T. Aventuras", url: "https://www.youtube.com/@juanjoteslaventuras", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Carlos Cuezva", url: "https://www.youtube.com/@CarlosCuezva", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Javi Manzanoo", url: "https://www.youtube.com/@javimanzanoo", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Crifedi", url: "https://www.youtube.com/@Crifedi", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Tescno Tesla", url: "https://www.youtube.com/@TecnoTesla", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Full Electric Mex", url: "https://www.youtube.com/@FullElectricMexico", favicon: "https://www.youtube.com/favicon.ico" }, null, null, { name: "La iA Jon", url: "https://www.youtube.com/@la_inteligencia_artificial", favicon: "https://www.youtube.com/favicon.ico" }, { name: "JF Ccalero", url: "https://www.youtube.com/@jfcalero", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Visual Politik", url: "https://www.youtube.com/@VisualPolitik", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Fabian Barrio", url: "https://www.youtube.com/@fabiancbarrio", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Loquetudigas", url: "https://www.youtube.com/@Loquetudigas", favicon: "https://www.youtube.com/favicon.ico" }, { name: "David Antunes", url: "https://www.youtube.com/@davidantunesmusic", favicon: "https://www.youtube.com/favicon.ico" }, { name: "TheWildProject", url: "https://www.youtube.com/@TheWildProject", favicon: "https://www.youtube.com/favicon.ico" }, { name: "Estas Tonne", url: "https://www.youtube.com/@Estastonne", favicon: "https://www.youtube.com/favicon.ico" }, { name: "BBC6 Music", url: "https://www.youtube.com/@BBC6Music", favicon: "https://www.youtube.com/favicon.ico" }, null, null ];
    const originalToggleRanges = [ { start: 18, end: 29, name: "ELECTROVERSE", label: "PdR,s" }, { start: 30, end: 41, name: "GROK", label: "iAs" }, { start: 42, end: 59, name: "TradingView", label: "Útil" }, { start: 60, end: 95, name: "JOdena", label: "Varios" } ];

    // --- Global Variables ---
    const TOTAL_CELLS = 96; const COLS = 6;
    const grid = document.getElementById('bookmark-grid');
    let isDarkMode = false; let pressStartTime = null; let reminderPressStartTime = null;
    let isActive = true; let isFooterVisible = true; let notices = []; let currentNoticeIndex = 0;
    let fromReminderModal = false; let isEditMode = false;
    let customData = { bookmarks: {}, toggles: {} };
    let cellElements = []; // **** DECLARED HERE ****
    let currentBookmarks = JSON.parse(JSON.stringify(originalBookmarks));
    let currentToggleRanges = JSON.parse(JSON.stringify(originalToggleRanges));
    // Declare variables for buttons created dynamically
    let onOffToggle, weatherButton, reminderButton, zoomButton, darkModeToggle;

    // --- Function Definitions (Moved to Top) ---

    function clamp(min, val, max) { return Math.min(Math.max(val, min), max); }
    function formatDateToDDMMMYY(dateStr) { if (!dateStr || !dateStr.match(/^\d{4}-\d{2}-\d{2}$/)) return '-'; try { const [y, m, d] = dateStr.split('-'); const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic']; const dt = new Date(Date.UTC(parseInt(y), parseInt(m) - 1, parseInt(d))); if (isNaN(dt.getTime())) return '-'; const vd = dt.getUTCDate(); const vm = dt.getUTCMonth(); const vy = dt.getUTCFullYear(); if (parseInt(d) !== vd || parseInt(m) !== (vm + 1) || parseInt(y) !== vy) return '-'; return `${String(vd).padStart(2, '0')}/${months[vm]}/${vy.toString().slice(-2)}`; } catch (e) { console.error("Fmt date err:", dateStr, e); return '-'; } }
    function generateBrightColor() { const h = Math.floor(Math.random() * 360); const s = 40 + Math.floor(Math.random() * 30); const l = 80 + Math.floor(Math.random() * 15); return `hsla(${h}, ${s}%, ${l}%, 0.64)`; }
    function areColorsSimilar(c1, c2) { if (!c1 || !c2) return false; try { const [h1] = c1.match(/\d+/g).map(Number); const [h2] = c2.match(/\d+/g).map(Number); const d = Math.abs(h1 - h2); return Math.min(d, 360 - d) < 60; } catch (e) { console.error("Color compare error:", c1, c2, e); return false; } }
    const getFaviconUrl = (bookmarkData) => { try { const urlToParse = bookmarkData.url || ''; const customFavicon = bookmarkData.favicon; if (customFavicon && (customFavicon.startsWith('data:image') || customFavicon.startsWith('http') || customFavicon.startsWith('./'))) return customFavicon; if (urlToParse) { const domain = new URL(urlToParse).hostname; return `https://www.google.com/s2/favicons?domain=${domain}&sz=64`; } } catch (e) { console.warn(`Invalid URL: ${bookmarkData?.url}`, e); } return 'https://via.placeholder.com/64'; };
    function showToast(message, type = 'info', duration = 3000) { const ex=document.getElementById('toast-notification-element'); if(ex)ex.remove(); const t=document.createElement('div'); t.id='toast-notification-element'; t.className=`toast-notification toast-${type}`; t.textContent=message; document.body.appendChild(t); requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.classList.add('show');});}); setTimeout(()=>{t.classList.remove('show'); t.addEventListener('transitionend',()=>{if(t.parentNode)t.parentNode.removeChild(t);},{once:true});},duration); }

    // --- UI Update Functions ---
    function updateUserIdDisplay() { const userIdDisplay = document.getElementById('user-id-display'); const userId = localStorage.getItem('userData_userId'); if (userIdDisplay) { if (userId) { userIdDisplay.textContent = userId.trim(); userIdDisplay.style.display = 'block'; } else { userIdDisplay.textContent = ''; userIdDisplay.style.display = 'none'; } } }
    function updateButtonStyles() { const darkModeToggle = document.getElementById('dark-mode-toggle'); const onOffToggle = document.getElementById('on-off-toggle'); const toggleButtons = document.querySelectorAll('.toggle-sign.range-toggle'); const weatherButton = document.getElementById('weather-button'); const zoomButton = document.getElementById('zoom-button'); const reminderButton = document.getElementById('reminder-button'); if (onOffToggle) { onOffToggle.src = `https://boardinggate.github.io/Tesla/${onOffToggle.dataset.state === 'on' ? 'IMG_4192.jpg' : 'IMG_4191.jpg'}`; onOffToggle.alt = `Toggle ${onOffToggle.dataset.state === 'on' ? 'On' : 'Off'}`; } if (darkModeToggle) { darkModeToggle.src = `https://boardinggate.github.io/Tesla/${isDarkMode ? 'oscuro2.png' : 'claro2.png'}`; darkModeToggle.alt = `Toggle ${isDarkMode ? 'Oscuro' : 'Claro'}`; } const reminders = JSON.parse(localStorage.getItem('reminders') || '[]'); const pendingCount = reminders.length; if (reminderButton) { reminderButton.innerHTML = `<img src="https://boardinggate.github.io/Tesla/IMG_4197.jpg" alt="Recordatorio" style="max-width: 70%; max-height: 70%; object-fit: contain;">${pendingCount > 0 ? `<span class="reminder-count">${pendingCount}</span>` : ''}`; reminderButton.style.backgroundColor = '#ABAB99'; } const baseBg = '#ABAB99'; if (isDarkMode) { toggleButtons.forEach(t => t.style.backgroundColor = baseBg); if (weatherButton) weatherButton.style.backgroundColor = baseBg; if (zoomButton) { zoomButton.style.backgroundColor = baseBg; zoomButton.classList.toggle('zoomed', zoomButton.dataset.zoomState === 'on'); } if (reminderButton) reminderButton.style.backgroundColor = baseBg; } else { toggleButtons.forEach(t => t.style.backgroundColor = baseBg); if (weatherButton) weatherButton.style.backgroundColor = baseBg; if (zoomButton) { zoomButton.style.backgroundColor = baseBg; zoomButton.classList.toggle('zoomed', zoomButton.dataset.zoomState === 'on'); } if (reminderButton) reminderButton.style.backgroundColor = baseBg; } }
    function applyZoom(state) { const originalWidth = 984; const adjustedWidth = 935; const originalCols = 6; const zoomedCols = 4; const gap = 15; const originalCellWidth = (originalWidth - (originalCols - 1) * gap) / originalCols; const zoomedCellWidth = (adjustedWidth - (zoomedCols - 1) * gap) / zoomedCols; const zoomButton = document.getElementById('zoom-button'); if (state === 'on') { grid.style.gridTemplateColumns = `repeat(${zoomedCols}, ${zoomedCellWidth}px)`; grid.style.gap = `${gap}px`; grid.style.maxWidth = `${adjustedWidth}px`; document.querySelectorAll('#bookmark-grid > div').forEach(c => { c.style.width = `${zoomedCellWidth}px`; c.style.height = `${zoomedCellWidth * 9 / 16}px`; }); document.querySelectorAll('.bookmark-item img').forEach(i => { i.style.width = '48px'; i.style.maxWidth = '56px'; }); document.querySelectorAll('.bookmark-name').forEach(n => { n.style.fontSize = 'clamp(1.05rem, 1.8vw, 1.35rem)'; }); document.querySelectorAll('.small-bookmark img').forEach(i => { i.style.width = '48px'; i.style.maxWidth = '56px'; }); document.querySelectorAll('.small-bookmark .bookmark-name').forEach(n => { n.style.fontSize = 'clamp(1.05rem, 1.8vw, 1.35rem)'; }); if (zoomButton) zoomButton.innerHTML = `<img src="./zoon+.png" alt="Zoom" style="max-width: 60%; max-height: 60%; object-fit: contain;">`; } else { grid.style.gridTemplateColumns = `repeat(${originalCols}, minmax(120px, 1fr))`; grid.style.gap = `${gap}px`; grid.style.maxWidth = `${originalWidth}px`; document.querySelectorAll('#bookmark-grid > div').forEach(c => { c.style.width = 'auto'; c.style.height = 'auto'; }); document.querySelectorAll('.bookmark-item img').forEach(i => { i.style.width = '36px'; i.style.maxWidth = '40px'; }); document.querySelectorAll('.bookmark-name').forEach(n => { n.style.fontSize = 'clamp(0.85rem, 1.5vw, 1.15rem)'; }); document.querySelectorAll('.small-bookmark img').forEach(i => { i.style.width = '24px'; i.style.maxWidth = '28px'; }); document.querySelectorAll('.small-bookmark .bookmark-name').forEach(n => { n.style.fontSize = 'clamp(0.85rem, 1.5vw, 1.15rem)'; }); if (zoomButton) zoomButton.innerHTML = `<img src="./zoon-.png" alt="Zoom" style="max-width: 60%; max-height: 60%; object-fit: contain;">`; } }
    function applyToggleVisibility() { const onOffToggle = document.getElementById('on-off-toggle'); const masterState = onOffToggle?.dataset.state || 'on'; for (let i = 0; i <= 17; i++) if (cellElements[i]) cellElements[i].classList.toggle('hidden', masterState === 'off'); document.querySelectorAll('.range-toggle').forEach(toggle => { const start = parseInt(toggle.dataset.rangeStart); const end = parseInt(toggle.dataset.rangeEnd); const state = toggle.dataset.state; if (!isNaN(start) && !isNaN(end)) { const shouldHide = masterState === 'off' || state === 'hidden'; for (let i = start; i <= end; i++) if (cellElements[i]) cellElements[i].classList.toggle('hidden', shouldHide); } }); }
    function adjustButtonPositions() { const scrollToggle = document.getElementById('scroll-toggle'); if (!scrollToggle) { console.warn("Scroll toggle not found for positioning."); return; } const scrollToggleHeight = scrollToggle.offsetHeight; const buttonHeight = 74; const buttonSpacing = 4; const startTop = scrollToggleHeight + 13; const fixedButtons = [ document.getElementById('on-off-toggle'), ...document.querySelectorAll('.range-toggle'), document.getElementById('weather-button'), document.getElementById('reminder-button'), document.getElementById('zoom-button'), document.getElementById('dark-mode-toggle') ].filter(button => button !== null); if (fixedButtons.length === 0) { console.warn("No side buttons found to position."); return; } let currentTop = startTop; fixedButtons.forEach((button) => { button.style.position = 'fixed'; button.style.top = `${currentTop}px`; button.style.left = '10px'; currentTop += buttonHeight + buttonSpacing; }); console.log(`Adjusted positions for ${fixedButtons.length} side buttons.`); }
    function updateNotice() { const nE = document.getElementById('current-notice'); if (!nE || notices.length === 0) return; if (!isActive) { nE.textContent = ''; nE.style.animation = 'none'; return; } nE.textContent = notices[currentNoticeIndex]; nE.style.animation = 'none'; void nE.offsetWidth; nE.style.animation = 'fadeInOut 14s infinite'; currentNoticeIndex = (currentNoticeIndex + 1) % notices.length; }
    function toggleNotices() { isActive = !isActive; console.log('Toggling notices:', isActive); const nC = document.querySelector('.notices-container'); const fC = document.querySelector('.footer-content'); const cW = document.querySelector('.counter-wrapper'); const nE = document.getElementById('current-notice'); if(nC) nC.style.display = isActive ? 'flex' : 'none'; if(fC) fC.style.display = isActive ? 'block' : 'none'; if (cW) cW.style.display = isActive ? 'flex' : 'none'; if (nE) { if (!isActive) { nE.textContent = ''; nE.style.animation = 'none'; } else { currentNoticeIndex = 0; updateNotice(); } } saveSettings(); }
    function toggleFooterVisibility() { const f = document.querySelector('footer'); if (!f) return; f.classList.toggle('footer-hidden', !isFooterVisible); }

    // --- Event Handling Functions ---
    function handleOnOffAction() { if (pressStartTime !== null) { const t = document.getElementById('on-off-toggle'); if (t) { const nS = t.dataset.state === 'on' ? 'off' : 'on'; updateAllToggles(nS); } } pressStartTime = null; }
    function handleReminderLongPress() { if (reminderPressStartTime === null) return; const dur = Date.now() - reminderPressStartTime; if (dur >= 2000) showAllReminders(); else showReminderModal(); reminderPressStartTime = null; }
    function handleSwipe() { const dist = touchEndX - touchStartX; const minDist = 100; if (dist > minDist) window.history.back(); else if (dist < -minDist) window.history.forward(); touchStartX = 0; touchEndX = 0; }

    // --- Initialization Functions ---
    async function loadNoticesAndStart() { try { await loadNotices(); startNoticeRotation(); } catch (e) { console.error("Notices fail", e); } }
    async function updateVersionInfo() { try { await updateVersion(); } catch (e) { console.error("Version update fail", e); } }
    function startReminderChecks() { checkReminders(); return setInterval(checkReminders, 60000); } // Return interval ID
    function addGlobalListeners() { const countEl = document.getElementById('reminder-count-globe'); if (countEl) { const openTable = (e) => { e.preventDefault(); e.stopPropagation(); showAllReminders(); }; countEl.addEventListener('click', openTable); countEl.style.cursor = 'pointer'; } const noticeIcon = document.getElementById('notice-toggle-icon'); if(noticeIcon) noticeIcon.addEventListener('click', toggleNotices); const backBtn = document.getElementById('back-button'); if(backBtn) backBtn.addEventListener('click', () => window.history.back()); const fwdBtn = document.getElementById('forward-button'); if(fwdBtn) fwdBtn.addEventListener('click', () => window.history.forward()); document.addEventListener('touchstart', (e) => { if (e.target.closest('button, a, input, textarea, .reminder-modal, .help-modal, .reminder-table-modal, .reminder-notification, #config-modal, .edit-modal')) touchStartX = 0; else touchStartX = e.changedTouches[0].screenX; }, { passive: true }); document.addEventListener('touchend', (e) => { if (touchStartX === 0) return; touchEndX = e.changedTouches[0].screenX; handleSwipe(); touchStartX = 0; touchEndX = 0; }); window.addEventListener('resize', adjustButtonPositions); }

    // --- Render Grid ---
    function renderGrid() { /* ... (Corrected version from previous step) ... */ grid.innerHTML = ''; cellElements.length = 0; const colors = Array(TOTAL_CELLS).fill(null); for (let i = 0; i < TOTAL_CELLS; i++) { if (currentBookmarks[i] !== null) { let color; let attempts = 0; do { color = generateBrightColor(); attempts++; } while ( attempts < 20 && ( (i >= COLS && colors[i - COLS] !== null && areColorsSimilar(color, colors[i - COLS])) || (i % COLS !== 0 && colors[i - 1] !== null && areColorsSimilar(color, colors[i - 1])) ) ); if(attempts >= 20) console.warn(`Color issue cell ${i}`); colors[i] = color; } } Array.from({ length: TOTAL_CELLS }).forEach((_, index) => { const cell = document.createElement('div'); const bookmarkData = currentBookmarks[index]; if (index < currentBookmarks.length && bookmarkData !== null) { const link = document.createElement('a'); link.className = 'bookmark-item'; link.title = bookmarkData.name; link.style.backgroundColor = colors[index]; link.href = bookmarkData.url || "#"; link.dataset.index = index; if (bookmarkData.name !== "Inicio Tesla" && bookmarkData.name !== "") { link.target = "_blank"; link.rel = "noopener noreferrer"; const img = document.createElement('img'); img.src = getFaviconUrl(bookmarkData); img.alt = `Favicon ${bookmarkData.name}`; img.loading = "lazy"; img.onerror = () => { console.warn(`Favicon fail: ${bookmarkData.name}`); img.src = 'https://via.placeholder.com/64'; img.onerror = null; }; if (bookmarkData.name === "Mis Updates") img.classList.add('favicon-red'); else if (bookmarkData.name === "Olas Updates") img.classList.add('favicon-blue'); const nameSpan = document.createElement('span'); nameSpan.className = 'bookmark-name'; nameSpan.textContent = bookmarkData.name; link.appendChild(img); link.appendChild(nameSpan); link.addEventListener('click', (event) => { if (isEditMode) { event.preventDefault(); showEditModal(index); } }); } cell.appendChild(link); } else { cell.className = 'bg-gray-50 border border-dashed border-gray-200 rounded-lg'; cell.style.backgroundColor = 'transparent'; } grid.appendChild(cell); cellElements.push(cell); }); }
    function renderToggleButtons() { /* ... (Corrected version from previous step) ... */ document.querySelectorAll('.range-toggle').forEach(btn => btn.remove()); const masterState = document.getElementById('on-off-toggle')?.dataset.state || 'on'; const savedToggleStates = JSON.parse(localStorage.getItem('toggleStates') || '{}'); currentToggleRanges.forEach((range) => { const toggle = document.createElement('span'); toggle.className = 'toggle-sign range-toggle'; toggle.dataset.rangeStart = range.start; toggle.dataset.rangeEnd = range.end; const currentState = savedToggleStates[range.start] || 'visible'; toggle.dataset.state = currentState; toggle.innerHTML = `<span class="sign">${currentState === 'visible' ? '-' : '+'}</span>${range.label}`; toggle.style.position = 'fixed'; toggle.style.top = '100px'; toggle.style.left = '10px'; toggle.addEventListener('click', (event) => { if (isEditMode) { event.preventDefault(); showEditModal(range.start, true); } else { updateToggleState(toggle); } }); document.body.appendChild(toggle); }); }
    function createOtherButtons() { /* ... (Corrected version from previous step) ... */ if (!document.getElementById('on-off-toggle')) { onOffToggle = document.createElement('img'); onOffToggle.className = 'toggle-image'; onOffToggle.id = 'on-off-toggle'; onOffToggle.dataset.state = 'on'; onOffToggle.src = `https://boardinggate.github.io/Tesla/IMG_4192.jpg`; onOffToggle.alt = 'Toggle On'; document.body.appendChild(onOffToggle); onOffToggle.addEventListener('mousedown', () => { pressStartTime = Date.now(); }); onOffToggle.addEventListener('mouseup', handleOnOffAction); onOffToggle.addEventListener('mouseleave', () => { pressStartTime = null; }); onOffToggle.addEventListener('touchstart', (e) => { e.preventDefault(); pressStartTime = Date.now(); }); onOffToggle.addEventListener('touchend', (e) => { e.preventDefault(); handleOnOffAction(); }); } if (!document.getElementById('weather-button')) { weatherButton = document.createElement('span'); weatherButton.className = 'toggle-sign'; weatherButton.id = 'weather-button'; weatherButton.innerHTML = `<img src="https://www.google.com/s2/favicons?domain=accuweather.com&sz=64" alt="Tiempo" style="max-width: 60%; max-height: 60%; object-fit: contain;">`; document.body.appendChild(weatherButton); weatherButton.addEventListener('click', () => { if (isEditMode) return; window.open('https://www.ventusky.com/?p=40.2;-4.7;5&l=rain-3h', '_blank'); }); } if (!document.getElementById('reminder-button')) { reminderButton = document.createElement('span'); reminderButton.className = 'toggle-sign'; reminderButton.id = 'reminder-button'; document.body.appendChild(reminderButton); reminderButton.addEventListener('mousedown', () => { reminderPressStartTime = Date.now(); }); reminderButton.addEventListener('mouseup', handleReminderLongPress); reminderButton.addEventListener('mouseleave', () => { reminderPressStartTime = null; }); reminderButton.addEventListener('touchstart', (e) => { e.preventDefault(); reminderPressStartTime = Date.now(); }); reminderButton.addEventListener('touchend', (e) => { e.preventDefault(); handleReminderLongPress(); }); } if (!document.getElementById('zoom-button')) { zoomButton = document.createElement('span'); zoomButton.className = 'toggle-sign'; zoomButton.id = 'zoom-button'; zoomButton.innerHTML = `<img src="./zoon-.png" alt="Zoom" style="max-width: 60%; max-height: 60%; object-fit: contain;">`; zoomButton.dataset.zoomState = 'off'; document.body.appendChild(zoomButton); zoomButton.addEventListener('click', () => { if (isEditMode) return; const cS = zoomButton.dataset.zoomState; const nS = cS === 'off' ? 'on' : 'off'; applyZoom(nS); zoomButton.dataset.zoomState = nS; updateButtonStyles(); saveSettings(); adjustButtonPositions(); }); } if (!document.getElementById('dark-mode-toggle')) { darkModeToggle = document.createElement('img'); darkModeToggle.className = 'toggle-image'; darkModeToggle.id = 'dark-mode-toggle'; document.body.appendChild(darkModeToggle); darkModeToggle.addEventListener('click', () => { isDarkMode = !isDarkMode; document.body.classList.toggle('dark-mode', isDarkMode); updateButtonStyles(); saveSettings(); }); } if (!document.getElementById('config-button')) { const configButton = document.createElement('span'); configButton.className = 'toggle-sign'; configButton.id = 'config-button'; configButton.innerHTML = `<img src="https://boardinggate.github.io/Tesla/config.jpg" alt="Configuración">`; document.body.appendChild(configButton); configButton.addEventListener('click', () => showConfigModal());} if (!document.getElementById('personal-button')) { const personalButton = document.createElement('span'); personalButton.className = 'toggle-sign'; personalButton.id = 'personal-button'; personalButton.innerHTML = `<img src="./personal.png" alt="Personal">`; document.body.appendChild(personalButton); personalButton.addEventListener('click', toggleEditMode);} if (!document.getElementById('home-button')) { const homeButton = document.createElement('span'); homeButton.className = 'toggle-sign'; homeButton.id = 'home-button'; homeButton.innerHTML = `<img src="./home.webp" alt="Inicio">`; document.body.appendChild(homeButton); homeButton.addEventListener('click', (e) => { if (isEditMode) { e.preventDefault(); return; } window.history.back(); });} if (!document.getElementById('reload-button')) { const reloadButton = document.createElement('span'); reloadButton.className = 'toggle-sign'; reloadButton.id = 'reload-button'; reloadButton.innerHTML = `<img src="./reload.webp" alt="Recargar">`; document.body.appendChild(reloadButton); reloadButton.addEventListener('click', () => { if (isEditMode) return; location.reload(); });} }

    // --- Edit Mode Functions ---
    function toggleEditMode() { /* ... (unchanged) ... */ const personalButton = document.getElementById('personal-button'); isEditMode = !isEditMode; if(personalButton) personalButton.classList.toggle('editing', isEditMode); document.body.classList.toggle('editing-active', isEditMode); if (isEditMode) { if (!sessionStorage.getItem('editModeExplained') && !localStorage.getItem('editModeExplained')) showEditInfoModal(); showToast("Modo Edición Activado", "info", 4000); grid.querySelectorAll('.bookmark-item').forEach(el => el.classList.add('editable')); document.querySelectorAll('.range-toggle').forEach(el => el.classList.add('editable')); } else { showToast("Modo Edición Desactivado", "info", 2000); grid.querySelectorAll('.bookmark-item').forEach(el => el.classList.remove('editable')); document.querySelectorAll('.range-toggle').forEach(el => el.classList.remove('editable')); } }
    function showEditInfoModal() { /* ... (unchanged) ... */ const modal = document.createElement('div'); modal.className = 'edit-info-modal'; modal.innerHTML = `<h2>Modo Edición</h2><p>Has entrado en modo edición.</p><ul class="list-disc pl-6 mb-4"><li>Clic en un <strong>marcador</strong> para cambiar Nombre, URL o Favicon.</li><li>Clic en una <strong>etiqueta de sección</strong> (PdR,s, etc.) para cambiar su nombre.</li><li>En el editor: Guarda, Cancela o Resetea al original.</li><li>Pulsa <img src="./personal.png" alt="P" style="width:20px;height:20px;display:inline;vertical-align:middle;"> de nuevo para <strong>salir</strong>.</li></ul><div class="flex justify-end"><button id="close-edit-info">Aceptar</button></div>`; document.body.appendChild(modal); modal.querySelector('#close-edit-info').addEventListener('click', () => { sessionStorage.setItem('editModeExplained', 'true'); localStorage.setItem('editModeExplained', 'true'); if (modal.parentNode) modal.parentNode.removeChild(modal); }); }
    function showEditModal(targetIndex, isToggle = false) { /* ... (unchanged) ... */ const existingModal = document.querySelector('.edit-modal'); if (existingModal) existingModal.remove(); const modal = document.createElement('div'); modal.className = 'edit-modal'; let currentItemData = {}; let originalItemData = {}; let title = ''; if (isToggle) { currentItemData = currentToggleRanges.find(r => r.start === targetIndex) || {}; originalItemData = originalToggleRanges.find(r => r.start === targetIndex) || {}; title = `Editar Etiqueta Sección`; modal.innerHTML = `<h2>${title}</h2><div><label for="edit-label">Etiqueta:</label><input type="text" id="edit-label" value="${currentItemData.label || ''}"></div><div class="button-group"><button class="save">Guardar</button><button class="reset">Resetear</button><button class="cancel">Cancelar</button></div>`; } else { currentItemData = currentBookmarks[targetIndex] || {}; originalItemData = originalBookmarks[targetIndex] || {}; title = `Editar Marcador: ${originalItemData.name || `Índice ${targetIndex}`}`; modal.innerHTML = `<h2>${title}</h2><div><label for="edit-name">Nombre:</label><input type="text" id="edit-name" value="${currentItemData.name || ''}"></div><div><label for="edit-url">URL:</label><input type="url" id="edit-url" value="${currentItemData.url || ''}" placeholder="https://ejemplo.com"></div><div><label for="edit-favicon">URL Favicon (Opcional):</label><input type="text" id="edit-favicon" value="${currentItemData.favicon || ''}" placeholder="Dejar vacío para auto"></div><div class="button-group"><button class="save">Guardar</button><button class="reset">Resetear</button><button class="cancel">Cancelar</button></div>`; } document.body.appendChild(modal);
        modal.querySelector('.save').addEventListener('click', () => { if (isToggle) { const newLabel = modal.querySelector('#edit-label').value.trim(); if (!newLabel) { showToast("Etiqueta vacía", "warning"); return; } if (!customData.toggles[targetIndex]) customData.toggles[targetIndex] = {}; customData.toggles[targetIndex].label = newLabel; const rangeIdx = currentToggleRanges.findIndex(r => r.start === targetIndex); if (rangeIdx > -1) currentToggleRanges[rangeIdx].label = newLabel; } else { const newName = modal.querySelector('#edit-name').value.trim(); const newUrl = modal.querySelector('#edit-url').value.trim(); const newFavicon = modal.querySelector('#edit-favicon').value.trim(); if (!newName || !newUrl) { showToast("Nombre y URL obligatorios", "warning"); return; } try { new URL(newUrl); } catch (_) { showToast("URL inválida", "warning"); return; } if (!customData.bookmarks[targetIndex]) customData.bookmarks[targetIndex] = {}; customData.bookmarks[targetIndex] = { name: newName, url: newUrl, favicon: newFavicon || null }; if(currentBookmarks[targetIndex]) { currentBookmarks[targetIndex].name = newName; currentBookmarks[targetIndex].url = newUrl; currentBookmarks[targetIndex].favicon = newFavicon || null; } } saveCustomData(); updateGridItemUI(targetIndex, isToggle); if (modal.parentNode) modal.parentNode.removeChild(modal); showToast("Actualizado", "success"); });
        modal.querySelector('.reset').addEventListener('click', () => { if (isToggle) { const originalLabel = originalItemData.label; if (customData.toggles?.[targetIndex]) { delete customData.toggles[targetIndex]; if (Object.keys(customData.toggles).length === 0) delete customData.toggles; } const rangeIdx = currentToggleRanges.findIndex(r => r.start === targetIndex); if (rangeIdx > -1) currentToggleRanges[rangeIdx].label = originalLabel; } else { const original = originalItemData; if (customData.bookmarks?.[targetIndex]) { delete customData.bookmarks[targetIndex]; if (Object.keys(customData.bookmarks).length === 0) delete customData.bookmarks; } if(currentBookmarks[targetIndex] && original) { currentBookmarks[targetIndex].name = original.name; currentBookmarks[targetIndex].url = original.url; currentBookmarks[targetIndex].favicon = original.favicon; } } saveCustomData(); updateGridItemUI(targetIndex, isToggle); if (modal.parentNode) modal.parentNode.removeChild(modal); showToast("Reseteado", "info"); });
        modal.querySelector('.cancel').addEventListener('click', () => { if (modal.parentNode) modal.parentNode.removeChild(modal); });
    }
    function updateGridItemUI(indexOrStart, isToggle = false) { /* ... (unchanged) ... */ if (isToggle) { const toggleButton = document.querySelector(`.range-toggle[data-range-start="${indexOrStart}"]`); const rangeData = currentToggleRanges.find(r => r.start === indexOrStart); if (toggleButton && rangeData) { const state = toggleButton.dataset.state || 'visible'; toggleButton.innerHTML = `<span class="sign">${state === 'visible' ? '-' : '+'}</span>${rangeData.label}`; } } else { const linkElement = grid.querySelector(`a[data-index="${indexOrStart}"]`); const bookmarkData = currentBookmarks[indexOrStart]; if (linkElement && bookmarkData) { linkElement.title = bookmarkData.name; linkElement.href = bookmarkData.url || '#'; const img = linkElement.querySelector('img'); const nameSpan = linkElement.querySelector('.bookmark-name'); if (img) { img.src = getFaviconUrl(bookmarkData); img.alt = `Favicon ${bookmarkData.name}`; img.classList.remove('favicon-red', 'favicon-blue'); if (bookmarkData.name === "Mis Updates") img.classList.add('favicon-red'); else if (bookmarkData.name === "Olas Updates") img.classList.add('favicon-blue'); } if (nameSpan) { nameSpan.textContent = bookmarkData.name; } } else { console.warn("Link element not found:", indexOrStart); renderGrid(); } } }

    // --- Reminder Functions (unchanged) ---
    function parseReminderText(text) { /* ... */ }
    function showHelpModal() { /* ... */ }
    function showReminderModal(reminder = null) { /* ... */ }
    function showReminderNotification(reminder) { /* ... */ }
    function showAllReminders() { /* ... */ }
    function updateReminderCount() { /* ... */ }
    function calculateNextOccurrence(reminder, referenceDate) { /* ... */ }
    function checkReminders() { /* ... */ }
    function startNoticeRotation() { /* ... */ }
    function calculatePostponedDateTime(mins) { /* ... */ }
    function showPostponeOptionsModal(reminder, source = 'notification') { /* ... */ }
    function showConfigModal() { /* ... */ }

    // --- Initial Setup ---
    document.addEventListener('DOMContentLoaded', async () => {
        console.log("DOM loaded");

        // 1. Load custom data for bookmarks and toggles
        loadCustomData();

        // 2. Render the main grid (uses currentBookmarks)
        renderGrid(); // This populates cellElements

        // 3. Create ALL dynamic buttons (assigns to global vars like onOffToggle)
        createOtherButtons();

        // 4. Render section toggle buttons (uses currentToggleRanges)
        renderToggleButtons(); // This creates the range toggle buttons

        // 5. Fetch external data and update static elements
        await updateVersionInfo();
        await loadNoticesAndStart(); // loads notices and calls updateNotice if needed

        // 6. Load UI states (applies dark mode, zoom, toggle visibility etc.)
        // This needs to run AFTER grid and ALL buttons are in the DOM
        loadSavedSettings();

        // 7. Load reminders and start checking interval
        loadReminders(); // Updates count display on reminder button
        const reminderCheckIntervalId = startReminderChecks();

        // 8. Add remaining global listeners
        addGlobalListeners();

        // 9. Initial positioning of side buttons AFTER they are created/rendered
        adjustButtonPositions();

        // Cleanup interval on page unload
        window.addEventListener('beforeunload', () => {
            if (reminderCheckIntervalId) clearInterval(reminderCheckIntervalId);
        });

        console.log("Setup complete.");
    });

</script>
</body>
</html>
