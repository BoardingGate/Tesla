// Crear botones de toggle
toggleRanges.forEach((range, index) => {
    const toggle = document.createElement('span');
    toggle.className = 'toggle-sign';
    toggle.innerHTML = `<span class="sign">-</span>${range.label}`;
    toggle.dataset.rangeStart = range.start;
    toggle.dataset.rangeEnd = range.end;
    toggle.dataset.state = 'visible';
    toggle.style.backgroundColor = '#696969'; // Gris oscuro inicial para "-"
    const scrollToggle = document.getElementById('scroll-toggle');
    const scrollRect = scrollToggle.getBoundingClientRect();
    toggle.style.left = `${scrollRect.left}px`;
    toggle.style.top = `${scrollRect.bottom + 20 + ((index + 1) * (toggle.offsetHeight + 20))}px`;
    document.body.appendChild(toggle);
});

// Crear botón On/Off
const onOffToggle = document.createElement('span');
onOffToggle.className = 'toggle-sign';
onOffToggle.id = 'on-off-toggle';
onOffToggle.textContent = 'On';
onOffToggle.dataset.state = 'on';
onOffToggle.style.backgroundColor = '#32CD32'; // Verde menos intenso inicial
onOffToggle.classList.add('on'); // Añadir clase para color negro
const scrollToggle = document.getElementById('scroll-toggle');
const scrollRect = scrollToggle.getBoundingClientRect();
onOffToggle.style.left = `${scrollRect.left}px`;
onOffToggle.style.top = `${scrollRect.bottom + 20}px`;
document.body.appendChild(onOffToggle);

function updateToggleState(toggle) {
    const start = parseInt(toggle.dataset.rangeStart);
    const end = parseInt(toggle.dataset.rangeEnd);
    const state = toggle.dataset.state;
    const label = toggleRanges.find(r => r.start === start).label;

    for (let i = start; i <= end; i++) {
        if (cellElements[i]) {
            if (state === 'visible') {
                cellElements[i].classList.add('hidden');
            } else {
                cellElements[i].classList.remove('hidden');
            }
        }
    }

    if (state === 'visible') {
        toggle.innerHTML = `<span class="sign">+</span>${label}`;
        toggle.style.backgroundColor = '#A9A9A9'; // Gris claro cuando oculto
        toggle.dataset.state = 'hidden';
    } else {
        toggle.innerHTML = `<span class="sign">-</span>${label}`;
        toggle.style.backgroundColor = '#696969'; // Gris oscuro cuando visible
        toggle.dataset.state = 'visible';
    }
}

function updateAllToggles(state) {
    const toggles = document.querySelectorAll('.toggle-sign:not(#on-off-toggle)');
    toggles.forEach(toggle => {
        if (state === 'on' && toggle.dataset.state === 'hidden') {
            updateToggleState(toggle);
        } else if (state === 'off' && toggle.dataset.state === 'visible') {
            updateToggleState(toggle);
        }
    });
    onOffToggle.textContent = state === 'on' ? 'On' : 'Off';
    onOffToggle.style.backgroundColor = state === 'on' ? '#32CD32' : '#A9A9A9';
    onOffToggle.dataset.state = state;
    if (state === 'on') {
        onOffToggle.classList.add('on');
    } else {
        onOffToggle.classList.remove('on');
    }
}
